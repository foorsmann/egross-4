!function(){"use strict";function t(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}customElements.get("product-form")||customElements.define("product-form",class extends HTMLElement{constructor(){super(),t(this,"toggleSpinner",t=>{const e=t?"add":"remove";this.form.closest(".product-form").classList[e]("adding")}),t(this,"showExceededQty",(t,e)=>{const i=t?.closest(".quantity-input");if(!i)return;i.dataset.overValue=e,i.classList.add("qty-over-limit");const o=()=>{i.classList.remove("qty-over-limit"),i.removeAttribute("data-over-value"),t.removeEventListener("input",o)};t.addEventListener("input",o)}),this.selectors={form:"form",inputId:"[name=id]",submitButton:'[name="add"]',errorWrapper:".prod__form-error",customFields:["[data-product-custom-field]"],dynamicCheckout:".prod__dynamic_checkout"},this.domNodes=queryDomNodes(this.selectors,this),this.form=this.domNodes.form,this.submitButton=this.domNodes.submitButton,this.domNodes.inputId.disabled=!1,this.notificationType=this.dataset.notificationType,this.customFields=document.querySelectorAll(this.selectors.customFields),this.domNodes.dynamicCheckout&&(this.enable_dynamic_checkout=!0),this.form.addEventListener("submit",this.onSubmitHandler.bind(this)),this.domNodes.dynamicCheckout&&this.customFields&&this.domNodes.dynamicCheckout.addEventListener("click",t=>{validateForm(this.form.closest(".main-product__blocks")).length>0&&(t.stopPropagation(),window.ConceptSGMTheme.Notification.show({target:this.domNodes.errorWrapper,method:"appendChild",type:"warning",message:window.ConceptSGMStrings.requiredField,delay:100}))},!0)}async onSubmitHandler(t){t.preventDefault(),this.toggleSpinner(!0);const e=validateForm(this.form.closest(".main-product__blocks"));if(e?.length>0)return this.toggleSpinner(!1),window.ConceptSGMTheme.Notification.show({target:this?.domNodes?.errorWrapper,method:"appendChild",type:"warning",message:window.ConceptSGMStrings.requiredField});const i=new FormData(this.form),o=parseInt(i.get("id"),10),s=parseInt(i.get("quantity"))||1,n=parseInt(this.form.querySelector('[name="quantity"]')?.max)||1/0;let r=0;try{const t=await fetch("/cart.js").then(t=>t.json());r=t.items?.find(t=>t.variant_id===o)?.quantity||0}catch(t){r=0}const a=Math.max(n-r,0);if(a<=0)return this.toggleSpinner(!1),window.ConceptSGMTheme.Notification.show({target:this?.domNodes?.errorWrapper,method:"appendChild",type:"warning",message:window.ConceptSGMStrings.cartLimit||"Cantitatea maxima pentru aceasta varianta este deja in cos."});if(s>a){i.set("quantity",a);const t=this.form.querySelector('[name="quantity"]');t&&(t.value=a,this.showExceededQty(t,s))}const d={method:"POST",headers:{Accept:"application/javascript","X-Requested-With":"XMLHttpRequest"},body:i},{ConceptSGMSettings:c,ConceptSGMStrings:m}=window;c.use_ajax_atc?fetch(`${c.routes.cart_add_url}`,d).then(async t=>{let e;try{const i=t.headers.get("content-type");if(i&&i.includes("application/json"))e=await t.json();else{e={message:await t.text()}}}catch(t){e={}}return{statusCode:t.status,body:e}}).then(({statusCode:t,body:e})=>{if(t>=400||e.status){let i=e.description||e.message||e.errors||window.ConceptSGMStrings.cartError;return 429===t&&(i="Ati trimis prea multe cereri. Va rugam sa incercati din nou mai tarziu."),window.ConceptSGMTheme.Notification.show({target:"toast"===this.notificationType?document.body:this.domNodes.errorWrapper,method:"appendChild",type:"warning",message:i,last:3e3,sticky:"toast"===this.notificationType})}c.enable_cart_drawer||window.ConceptSGMTheme.Notification.show({target:this.domNodes.errorWrapper,method:"appendChild",type:"success",message:window.ConceptSGMStrings.itemAdded,last:3e3,sticky:"toast"===this.notificationType}),window.ConceptSGMEvents.emit("ON_ITEM_ADDED",e),window.Shopify.onItemAdded(e)}).catch(()=>{}).finally(()=>{this.toggleSpinner(!1)}):this.form.submit()}})}();